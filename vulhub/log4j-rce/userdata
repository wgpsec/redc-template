#!/bin/bash
set -e

echo "=========================================="
echo "Vulhub Log4j RCE 环境部署脚本"
echo "CVE-2021-44228 (Log4Shell)"
echo "=========================================="

if ! command -v docker &> /dev/null; then
    echo "[*] 安装 Docker..."
    curl -fsSL https://get.docker.com -o get-docker.sh
    sh get-docker.sh
    systemctl enable docker
    systemctl start docker
    echo "[*] Docker 安装完成"
else
    echo "[*] Docker 已安装"
fi

echo "[*] 等待 Docker 服务启动..."
sleep 3

echo "[*] 拉取 Vulhub Log4j 镜像..."
docker pull vulhub/log4j:2.17.0

echo "[*] 启动 Log4j 漏洞环境..."
docker run -d --name log4j-target -p 8989:8989 vulhub/log4j:2.17.0

echo ""
echo "=========================================="
echo "Log4j RCE 环境部署完成!"
echo "=========================================="
echo "漏洞环境: CVE-2021-44228 (Log4Shell)"
echo "服务端口: 8989"
echo "测试路径: http://<your-ip>:8989"
echo ""
echo "注意事项:"
echo "- 此环境仅用于安全研究，请勿用于非法用途"
echo "- 建议在防火墙中限制访问来源"
echo "=========================================="
